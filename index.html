<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–ü–µ—Ä—Å–æ–Ω–∞–∂ —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #ui {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.95);
      padding: 15px;
      border-radius: 10px;
      font-family: Arial, sans-serif;
      z-index: 1000;
    }
    button {
      display: block;
      margin: 5px 0;
      padding: 10px 15px;
      background: #5a8eff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    #status {
      margin-top: 10px;
      font-size: 13px;
      color: #555;
    }
  </style>
</head>
<body>
  <div id="ui">
    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏</h3>
    <button onclick="playAnimation('walk')">üö∂ –•–æ–¥—å–±–∞</button>
    <button onclick="playAnimation('waving')">üëã –ú–∞—Ö–∞–Ω–∏–µ</button>
    <button onclick="playAnimation('jump')">ü¶ò –ü—Ä—ã–∂–æ–∫</button>
    <div id="status">–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏...</div>
  </div>

  <a-scene background="color: black">
    <a-assets>
      <a-asset-item id="mainModel" src="assets/walk_man.glb"></a-asset-item>
      <a-asset-item id="wavingAnim" src="assets/waving.glb"></a-asset-item>
      <a-asset-item id="jumpAnim" src="assets/jump.glb"></a-asset-item>
      <img id="starry-sky" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg" crossorigin="anonymous">
    </a-assets>

    <!-- –°—Ñ–µ—Ä–∞ –Ω–µ–±–∞ -->
    <a-sky src="#starry-sky" rotation="0 -90 0"></a-sky>

    <!-- –ú–æ–¥–µ–ª—å -->
    <a-entity id="character"
              gltf-model="#mainModel"
              position="0 0 -3"
              scale="1 1 1"
              my-animation></a-entity>

    <!-- –°–≤–µ—Ç -->
    <a-light type="ambient" intensity="1.0"></a-light>
    <a-light type="directional" intensity="0.6" position="-1 2 1"></a-light>

    <!-- –ö–∞–º–µ—Ä–∞ -->
    <a-camera position="0 1.6 3"></a-camera>
  </a-scene>

  <script>
    let mixer, model;
    const animations = {};
    const loader = new THREE.GLTFLoader();

    AFRAME.registerComponent('my-animation', {
      init: function () {
        const el = this.el;
        el.addEventListener('model-loaded', () => {
          model = el.getObject3D('mesh');
          const gltf = el.components['gltf-model'].model;

          mixer = new THREE.AnimationMixer(model);

          if (gltf.animations.length > 0) {
            animations['walk'] = gltf.animations[0];
            updateStatus('–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ –∞–Ω–∏–º–∞—Ü–∏—é.');
            loadExternalAnimations();
          } else {
            updateStatus('–í –º–æ–¥–µ–ª–∏ –Ω–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –∞–Ω–∏–º–∞—Ü–∏–π.');
          }
        });
      },
      tick: function (_, delta) {
        if (mixer) mixer.update(delta / 1000);
      }
    });

    function loadExternalAnimations() {
      loader.load('assets/waving.glb', (gltf) => {
        if (gltf.animations[0]) {
          animations['waving'] = gltf.animations[0];
        }
      });

      loader.load('assets/jump.glb', (gltf) => {
        if (gltf.animations[0]) {
          animations['jump'] = gltf.animations[0];
        }
      });
    }

    function playAnimation(name) {
      if (!mixer || !animations[name]) {
        updateStatus(`–û—à–∏–±–∫–∞: –∞–Ω–∏–º–∞—Ü–∏—è "${name}" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
        return;
      }

      mixer.stopAllAction();
      const action = mixer.clipAction(animations[name]);
      action.reset().fadeIn(0.3).play();
      updateStatus(`–ê–Ω–∏–º–∞—Ü–∏—è: ${name}`);
    }

    function updateStatus(text) {
      document.getElementById('status').textContent = text;
    }
  </script>
</body>
</html>
